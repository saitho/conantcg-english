{{ $perRow := 6 }}

<style>
    /* Progressively enhance the JS-only form from a disabled-ish state */
    filter-container:not(:defined) .demo-filter-form {
        opacity: .4;
        pointer-events: none;
    }

    fieldset, div.fieldset {
        display: flex;
        flex-direction: row;
        width: 100%;
    }
    legend {
        background: grey;
        display: inline-block;
        padding: 0.25rem 0.5rem;
        width: 10vw;
    }
    legend, label, label > input, label > select {
        height: 50px;
    }
    label, label > input, label > select {
        width: 100%;
    }

    .card-list {
        display: grid;
        grid-template-columns: repeat({{ $perRow }}, 1fr);
        gap: 1rem;
        height: fit-content;
    }

    .card-list__item {
        display: flex;
        align-items: center;
        img {
            margin: 0;
            width: 100%;
            height: auto;
            cursor: pointer;
        }
    }
</style>

<filter-container oninit delimiter="," filter-mode="all" filter-mode-continent="any">
    <!--
    <form class="demo-filter-form">
        <div class="fieldset">
            <legend>Name</legend>
            <label>
                <input type="text" name="name" data-filter-key="name">
            </label>
        </div>
        <div class="fieldset">
            <legend>Product</legend>
            <label>
                <select name="product" data-filter-key="product">
                    <option value="">Any</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
            </label>
        </div>

        <div class="fieldset">
            <legend>Color</legend>
            <div class="flex w-full">
                <label class="flex"><input type="checkbox" name="color" value="blue" data-filter-key="color">Blue</label>
                <label class="flex"><input type="checkbox" name="color" value="green" data-filter-key="color">Green</label>
                <label class="flex"><input type="checkbox" name="color" value="white" data-filter-key="color">White</label>
                <label class="flex"><input type="checkbox" name="color" value="red" data-filter-key="color">Red</label>
                <label class="flex"><input type="checkbox" name="color" value="yellow" data-filter-key="color">Yellow</label>
            </div>
        </div>
        <div class="fieldset">
            <legend>Type</legend>
            <div class="flex w-full">
                <label class="flex"><input type="checkbox" name="type" value="partner" data-filter-key="type">Partner</label>
                <label class="flex"><input type="checkbox" name="type" value="character" data-filter-key="type">Character</label>
                <label class="flex"><input type="checkbox" name="type" value="event" data-filter-key="type">Event</label>
                <label class="flex"><input type="checkbox" name="type" value="incident" data-filter-key="type">Incident</label>
            </div>
        </div>
        <div class="fieldset">
            <legend>Rarity</legend>
            <div class="flex w-full">
                <label class="flex"><input type="checkbox" name="rarity" value="C" data-filter-key="rarity">Partner</label>
                <label class="flex"><input type="checkbox" name="rarity" value="CP" data-filter-key="rarity">CP</label>
                <label class="flex"><input type="checkbox" name="rarity" value="R" data-filter-key="rarity">R</label>
                <label class="flex"><input type="checkbox" name="rarity" value="RP" data-filter-key="rarity">RP</label>
                <label class="flex"><input type="checkbox" name="rarity" value="SR" data-filter-key="rarity">SR</label>
                <label class="flex"><input type="checkbox" name="rarity" value="SRP" data-filter-key="rarity">SRP</label>
                <label class="flex"><input type="checkbox" name="rarity" value="D" data-filter-key="rarity">D</label>
                <label class="flex"><input type="checkbox" name="rarity" value="PR" data-filter-key="rarity">PR</label>
            </div>
        </div>
        <button type="reset">Reset</button>
        <p data-filter-results="card/cards" aria-live="polite"></p>
    </form> -->

    <div class="card-list">
    {{ $counter := 0 }}
    {{ range site.Data.cards_ja }}
        {{ $title := or (T (printf "cards.%s.title" .card_num )) .title }}
        {{ $feature := or (T (printf "cards.%s.feature" .card_num )) .feature }}
        {{ $type := or (T (printf "types.%s" .type )) .type }}
        {{ $product := or (T (printf "products.%s" .package )) .package }}
        {{ $color := or (T (printf "colors.%s" .color )) .color }}

        {{ $categories := slice }}
        {{range .categories}}{{ $categories = $categories | append (or (T (printf "categories.%s" . )) .) }}{{end}}

        <div class="card-list__item"
             data-popover-target="card-{{ .id }}"
             data-popover-trigger="click"
             data-popover-placement="{{ if ge (mod $counter $perRow) 4 }}left{{ else }}right{{ end }}"
             type="button"
             title="{{.card_num}}"
             data-filter-name="{{ $title }}"
             data-filter-color="{{ $color }}"
             data-filter-product="{{ $product }}"
             data-filter-rarity="{{ .rarity }}"
             data-filter-cost="{{ .cost }}"
             data-filter-ap="{{ .ap }}"
             data-filter-lp="{{ .lp }}"
             data-filter-categories="{{delimit $categories ","}}"
             data-filter-type="{{ $type }}"
        >
            {{ $card := . }}
            {{ with resources.Get (printf "cards/%.0f.ja.jpg" .id) }}
                {{ with .Resize "200x" }}
                <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" alt="">
                {{ end }}

                <div data-popover id="card-{{ $card.id }}" role="tooltip"
                     class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800"
                >
                    <div class="flex" style="flex-direction: row{{ if ge (mod $counter $perRow) 4 }}-reverse{{ end }}">
                        {{ with .Resize "400x" }}
                        <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" alt="">
                        {{ end }}

                        <div style="min-width: 400px;" class="bg-white dark:bg-warmgray-800 dark:text-white">
                            <div class="px-2 py-2 bg-gray-100 border-b border-gray-200 rounded-t-lg dark:border-gray-600 dark:bg-gray-700">
                                <h3 class="font-semibold text-gray-900 dark:text-white text-lg">{{ $title }}</h3>
                            </div>
                            <div class="px-2 py-2">
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Card ID</div>
                                    <div class="text-end">{{ $card.card_num }}</div>
                                </div>
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Card Category</div>
                                    <div class="text-end">{{ $type }}</div>
                                </div>
                                {{ if ne $type "Case" }}
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Effect</div>
                                    <div class="text-end">{{ if $feature }}{{ $feature }}{{ else }} â€“ {{ end }}</div>
                                </div>
                                {{ end }}
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Product</div>
                                    <div class="text-end">{{ $product }}</div>
                                </div>
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Color</div>
                                    <div class="text-end">{{ $color }}</div>
                                </div>
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Rarity</div>
                                    <div class="text-end">{{ $card.rarity }}</div>
                                </div>
                                {{ if eq $type "Character" }}
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Categories</div>
                                    <div class="text-end">{{delimit $categories ", "}}</div>
                                </div>
                                {{ end }}
                                {{ if or (eq $type "Character") (eq $type "Event") }}
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Cost</div>
                                    <div class="text-end">{{ $card.cost }}</div>
                                </div>
                                {{ end }}
                                {{ if eq $type "Character" }}
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">AP</div>
                                    <div class="text-end">{{ $card.ap }}</div>
                                </div>
                                {{ end }}
                                {{ if or (eq $type "Character") (eq $type "Partner") }}
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">LP</div>
                                    <div class="text-end">{{ $card.lp }}</div>
                                </div>
                                {{ end }}
                                {{ if $card.illustrator }}
                                <div class="flex justify-between">
                                    <div class="text-start font-bold">Illustrator</div>
                                    <div class="text-end">{{ $card.illustrator }}</div>
                                </div>
                                {{ end }}
                            </div>
                        </div>
                    </div>
                    <div data-popper-arrow></div>
                </div>
            {{ end }}
        </div>
        {{ $counter = add $counter 1 }}
    {{ end }}
    </div>
</filter-container>

<script type="module" src="js/filter-container/filter-container.js"></script>